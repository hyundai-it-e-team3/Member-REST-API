<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.mycompany.memberAPI.dao.SavePointDao">
	<insert id="insertPoint" parameterType="savePoint">
		INSERT INTO save_point
		VALUES (seq_save_point.NEXTVAL, #{point}, #{balance}, #{content}, sysdate, sysdate+30, 'Y', #{memberId})
	</insert>
	
	<select id="getAvailableOlderPoint" parameterType="String" resultType="savePoint">
		<![CDATA[ 
			SELECT *
			FROM (SELECT *
				  FROM save_point
				  WHERE member_id = #{memberId}
				  AND STATUS = 'Y'
			 	  ORDER BY reg_date)
			WHERE ROWNUM <= 1
		]]>
	</select>
	
	<update id="updateBalance" parameterType="savePoint">
		UPDATE save_point
		SET balance = #{balance},
			status = #{status}
		WHERE save_point_seq = #{savePointSeq}
	</update>
</mapper>